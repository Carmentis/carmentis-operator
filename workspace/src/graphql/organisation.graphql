fragment UserEntity on UserEntity {
  publicKey
  isAdmin
  firstname
  lastname
}

query GetOrganisations {
  organisations {
    id,
    name,
    publicSignatureKey
  }
}


query GetOrganisation($id: Int!) {
  organisation(id: $id) {
    id
    name
    publicSignatureKey
    createdAt
    logoUrl
    published
    balance
    isDraft
    publishedAt
    city
    website
    countryCode
    virtualBlockchainId
    version
  }
}

query GetOrganisationBalance($id: Int!) {
  organisation(id: $id) {
    id
    balance
    hasTokenAccount
  }
}

query GetOrganisationStatistics($id: Int!) {
  getOrganisationStatistics(id: $id) {
    numberOfApplications
    numberOfUsers
  }
}

mutation CreateOrganisation($name: String!) {
  createOrganisation(name: $name) {
    id
    name
    publicSignatureKey
  }
}

mutation UpdateOrganisation($id: Int!, $name: String!, $website: String!, $city: String!, $countryCode: String!) {
  updateOrganisation(id: $id, name: $name, website: $website, city: $city, countryCode: $countryCode) {
    id
  }
}

mutation PublishOrganisation($organisationId: Int!) {
  publishOrganisation(id: $organisationId)
}


mutation PublishApplication($applicationId: Int!) {
  publishApplication(applicationId: $applicationId)
}

mutation DeleteOrganisation($id: Int!) {
  deleteOrganisation(id: $id) {
    id
  }
}

fragment ApiKeyDescription on ApiKeyType {
  id
  isActive
  activeUntil
  name
  partialKey
  createdAt
  application {
    id
    name
  }
}


fragment ApiKeyUsage on ApiKeyUsageType {
  id
  ip
  requestMethod
  requestUrl
  responseStatus
  usedAt
}



query GetApiKey($id: Int!) {
  getApiKey(id: $id) {
    ...ApiKeyDescription
  }
}

query GetApiKeys($id: Int!) {
  getAllApiKeysOfOrganisation(organisationId: $id) {
    ...ApiKeyDescription
  }
}

query GetApiKeyUsage($id: Int!, $offset: Int!, $limit: Int!, $filterByUnauthorised: Boolean!) {
  getApiKey(id: $id) {
    countUsages(filterByUnauthorised: $filterByUnauthorised)
  }
  getApiKey(id: $id) {
    ...ApiKeyDescription
    usages(limit: $limit, offset: $offset, filterByUnauthorized: $filterByUnauthorised) {
      ...ApiKeyUsage
    }
  }
}

mutation UpdateKey($id: Int!, $name: String!, $isActive: Boolean!) {
  updateApiKey(id: $id, name: $name, isActive: $isActive)
}


query GetUsersInOrganisation($id: Int!) {
  organisation(id: $id) {
    users {
      ...UserEntity
    }
  }
}

mutation AddExistingUserInOrganisation($organisationId: Int!, $userPublicKey: String!) {
  addUserInOrganisation(organisationId: $organisationId, userPublicKey: $userPublicKey)
}

mutation removeUserInOrganisation($organisationId: Int!, $userPublicKey: String!) {
  removeUserFromOrganisation(organisationId: $organisationId, userPublicKey: $userPublicKey)
}


fragment ApplicationSummaryType on ApplicationType {
  id
  name
  isDraft
  publishedAt
  published
  version
}

fragment ApplicationType on ApplicationType {
  ...ApplicationSummaryType
  website
  description
  domain
  website
  virtualBlockchainId
  logoUrl
}


query getAllApplicationsInOrganisation($organisationId: Int!) {
  getAllApplicationsInOrganisation(organisationId: $organisationId) {
    ...ApplicationSummaryType
  }
}

query getApplicationInOrganisation($applicationId: Int!) {
  getApplicationInOrganisation(applicationId: $applicationId) {
    ...ApplicationType
  }
}

mutation createApplication($organisationId: Int!, $applicationName: String!) {
  createApplicationInOrganisation(organisationId: $organisationId, applicationName: $applicationName) {
    id
  }
}

mutation updateApplication($applicationId: Int!, $application: ApplicationUpdateDto!) {
  updateApplicationInOrganisation(applicationId: $applicationId, applicationUpdate: $application) {
    id
  }
}

mutation deleteApplication($applicationId: Int!) {
  deleteApplicationInOrganisation(applicationId: $applicationId)
}

query getAllApiKeysInApplication($applicationId: Int!) {
  getAllApiKeysOfApplication(applicationId: $applicationId) {
    ...ApiKeyDescription
  }
}

fragment CreatedApiKey on RevealedApiKeyType {
  name,
  activeUntil,
  key
}
mutation createApiKeyInApplication($applicationId: Int!, $name: String!, $activeUntil: String!) {
  createApiKey(applicationId: $applicationId, name: $name, activeUntil: $activeUntil) {
   ...CreatedApiKey
  }
}

mutation changeOrganisationKey($organisationId: Int!, $privateKey: String!) {
  changeOrganisationKeyPair(organisationId: $organisationId, privateKey: $privateKey)
}

mutation deleteApiKey($keyId: Int!) {
  deleteApiKey(id: $keyId)
}

fragment Transaction on TransactionType {
  amount
  linkedAccount
  chainReference
  previousHistoryHash
  timestamp
}
query getTransactionsOfOrganisation($organisationId: Int!, $limit: Int!, $fromHash: String) {
  organisation(id: $organisationId) {
    hasTokenAccount
    transactions(limit: $limit, fromHistoryHash: $fromHash) {
      ...Transaction
    }
  }
}


query hasPublishedAccountOnChain($organisationId: Int!) {
  organisation(id: $organisationId) {
    hasTokenAccount
  }
}


query getOrganisationChainStatus($organisationId: Int!) {
  organisation(id: $organisationId) {
    chainStatus {
      hasTokenAccount,
      isPublishedOnChain
    }
  }
}